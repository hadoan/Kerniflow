model OutboxEvent {
  id          String   @id @default(cuid())
  tenantId    String
  eventType   String
  payloadJson String
  status      OutboxStatus @default(PENDING)
  attempts    Int      @default(0)
  availableAt DateTime @default(now())
  correlationId String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([tenantId, status, availableAt])
}

model DomainEvent {
  id        String   @id @default(cuid())
  tenantId  String
  eventType String
  payload   String
  createdAt DateTime @default(now())

  @@index([tenantId, eventType])
}

model AuditLog {
  id        String   @id @default(cuid())
  tenantId  String
  action    String
  actorUserId String?
  entity    String
  entityId  String
  details   String?
  createdAt DateTime @default(now())

  @@index([tenantId, entity, entityId])
  @@index([tenantId, action])
}

model IdempotencyKey {
  id           String   @id @default(cuid())
  tenantId     String?
  actionKey    String
  key          String
  userId       String?
  requestHash  String?
  status       String   @default("IN_PROGRESS")
  responseJson String?
  responseStatus Int?
  statusCode   Int?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  expiresAt    DateTime?

  @@unique([tenantId, actionKey, key])
  @@index([tenantId, actionKey])
}

enum OutboxStatus {
  PENDING
  SENT
  FAILED
}
