model Document {
  id           String          @id @default(cuid())
  tenantId     String
  type         DocumentType
  status       DocumentStatus
  title        String?
  errorMessage String?
  metadataJson Json?
  archivedAt   DateTime?       @db.Timestamptz(6)
  archivedByUserId String?
  createdAt    DateTime        @default(now()) @db.Timestamptz(6)
  updatedAt    DateTime        @updatedAt @db.Timestamptz(6)

  files File[]
  links DocumentLink[]

  @@index([tenantId])
  @@index([tenantId, type])
  @@index([tenantId, archivedAt])
}

model File {
  id              String            @id @default(cuid())
  tenantId        String
  documentId      String
  kind            FileKind
  storageProvider StorageProvider
  bucket          String
  objectKey       String
  contentType     String?
  sizeBytes       Int?
  sha256          String?
  createdAt       DateTime          @default(now()) @db.Timestamptz(6)

  document Document @relation(fields: [documentId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, documentId])
  @@index([objectKey])
}

model DocumentLink {
  id         String                  @id @default(cuid())
  tenantId   String
  documentId String
  entityType DocumentLinkEntityType
  entityId   String
  createdAt  DateTime                @default(now()) @db.Timestamptz(6)

  document Document @relation(fields: [documentId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, entityType, entityId])
}

enum DocumentType {
  UPLOAD
  RECEIPT
  CONTRACT
  INVOICE_PDF
  OTHER
}

enum DocumentStatus {
  PENDING
  READY
  FAILED
  QUARANTINED
}

enum FileKind {
  ORIGINAL
  DERIVED
  GENERATED
}

enum StorageProvider {
  gcs
  s3
  azure
}

enum DocumentLinkEntityType {
  INVOICE
  EXPENSE
  AGENT_RUN
  MESSAGE
  OTHER
}
